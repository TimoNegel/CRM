@attribute [Authorize]
@page "/kunde/view/{Id:guid}"

<MudText Typo="Typo.h4">Kunde Details</MudText>
<br />

<MudCard>
    <MudCardContent>
        <MudText><b>Firmenname:</b> @kunde.Firmenname</MudText>
        <MudText><b>Ansprechpartner:</b> @kunde.AnsprechpartnerVorname @kunde.AnsprechpartnerNachname</MudText>
        <MudText><b>Telefonnummer:</b> @kunde.Tel</MudText>
        <MudText><b>E-Mail:</b> @kunde.Email</MudText>

        <MudText Typo="Typo.h5">Adresse</MudText>
        <MudText><b>Straße:</b> @kunde.Adresse.Strasse</MudText>
        <MudText><b>Hausnummer:</b> @kunde.Adresse.Hausnummer</MudText>
        <MudText><b>Ort:</b> @kunde.Adresse.Ort</MudText>
        <MudText><b>PLZ:</b> @kunde.Adresse.PLZ</MudText>
        <MudText><b>Land:</b> @kunde.Adresse.Land</MudText>
    </MudCardContent>

    <MudCardActions>
        <MudButton Color="Color.Primary" OnClick="() => NavigateToEditKundePage()">Bearbeiten</MudButton>
        <MudButton Color="Color.Error" OnClick="() => DeleteKunde()">Löschen</MudButton>
    </MudCardActions>
</MudCard>

@code {
    [Parameter] public Guid Id { get; set; }
    private Kunde kunde = new Kunde { Adresse = new Adresse() };

    protected override async Task OnInitializedAsync()
    {
        using var context = DbFactory.CreateDbContext();
        kunde = await context.Kunden.Include(k => k.Adresse).FirstOrDefaultAsync(k => k.Id == Id);
    }

    private void NavigateToEditKundePage()
    {
        Navigation.NavigateTo($"/kunde/edit/{Id}");
    }

    private async Task DeleteKunde()
    {
        using var context = DbFactory.CreateDbContext();
        var kundeToDelete = context.Kunden.FirstOrDefault(k => k.Id == Id);
        if (kundeToDelete != null)
        {
            context.Kunden.Remove(kundeToDelete);
            await context.SaveChangesAsync();
            Navigation.NavigateTo("/kunden/view");
        }
    }
}
